

# Материалы
[Использование утилиты UFW на Linux. UFW является самым простым и довольно популярным инструментарием командной строки для настройки и управления брандмауэром в дистрибутивах Ubuntu и Debian](https://1cloud.ru/help/security/ispolzovanie-utility-ufw-na-inux)

[Пример разворачивания сервера в контейнере Docker на Yandex Cloud](https://green-api.com/docs/sdk/python/pythonWebhookServer/serverDockerOnYandexCloud/)

[Поиск по командам Ubuntu](explainshell.com)

[Полное практическое руководство по Docker: с нуля до кластера на AWS](https://habr.com/ru/articles/310460/)

[Git repo of the Docker "Official Image" for postgres. docker-library/postgres](https://github.com/docker-library/postgres)

[HA Postgresql cluster on docker](https://www.opensourceagenda.com/projects/ha-postgres-docker-stack)

[Docker container Patroni article](https://www.programmersought.com/article/177611139093/)

[Patroni: A Template for PostgreSQL HA with ZooKeeper, etcd or Consul](https://github.com/UKHomeOffice/docker-postgres-patroni-not-tracking/blob/master/patroni/README.rst)


# PostgreSQL из пакетов
    sudo apt install postgres

 ## Деинсталляция и удаление  PostgreSQL on Debian Linux. You can use the apt-get command to completely remove PostgreSQL on a Debian-based distribution of Linux such as Linux Mint or Ubuntu:
    1. sudo apt-get --purge remove postgresql
    2. sudo apt-get purge postgresql*
    3. sudo apt-get --purge remove postgresql postgresql-doc postgresql-common

 ## Удалить кластер:
    sudo systemctl stop postgresql@16-main
    sudo pg_dropcluster 16 main


# Кастомный PostgreSQL из пакетов
    • [Linux downloads (Ubuntu)](https://www.postgresql.org/download/linux/ubuntu/)
    • после установки останавливаем и удаляем кластер
    • создаем заново с именем test
    • настраиваем для удаленного подключения netstat -na|grep 5432
    • /etc/postgres/13/test/postgresql.conf
    • pg_hba.conf
    • пароль postgres
    • рестарт кластера 
    
    psql -h 104.197.151.20 -U postgres

# PostgreSQL из исходников
    для гурманов и применения кастомных патчей - патч заменяет код на С на свой самый большой минус - апгрейд версии постгреса
    https://github.com/AbdulYadi/postgresql-private
    INSTALL Short Version
    ./configure
    make
    su
    make install
    adduser postgres
    mkdir /usr/local/pgsql/data
    chown postgres /usr/local/pgsql/data
    su - postgres
    /usr/local/pgsql/bin/initdb -D /usr/local/pgsql/data
    /usr/local/pgsql/bin/pg_ctl -D /usr/local/pgsql/data -l logfile start
    /usr/local/pgsql/bin/createdb test
    /usr/local/pgsql/bin/psqltest

# Кодировка при установке
    Рекомендуется только UTF!!!

# Практика
  PostgreSQL docker images
    • [Bitnami PostgreSQL Docker Image. rogervaas/bitnami-docker-postgresql](https://github.com/rogervaas/bitnami-docker-postgresql)
    • [Dockerfile source for postgresql docker image. GoogleCloudPlatform/postgresql-docker](https://github.com/GoogleCloudPlatform/postgresql-docker)
  PostgreSQL K8s yaml files
    • [Google Click to Deploy. GoogleCloudPlatform/click-to-deploy](https://github.com/GoogleCloudPlatform/click-to-deploy/tree/master/k8s/postgresql)
  PostgreSQL Helm charts
    • [Bitnami package for PostgreSQL HA. This PostgreSQL cluster solution includes the PostgreSQL replication manager, an open-source tool for managing replication and failover on PostgreSQL clusters.](https://github.com/bitnami/charts/tree/master/bitnami/postgresql-ha)
  PostgreSQL K8s operator
    • [PGO, the Postgres Operator from Crunchy Data, gives you a declarative Postgres solution that automatically manages your PostgreSQL clusters. CrunchyData/postgres-operator](https://github.com/CrunchyData/postgres-operator)
    • [The Postgres operator manages PostgreSQL clusters on Kubernetes (K8s)](https://postgres-operator.readthedocs.io/en/latest/)


 [Install Docker Engine on Ubuntu](https://docs.docker.com/engine/install/ubuntu/)
   1. Создаем docker-сеть:
       $ sudo docker network create pg-net
   2. подключаем созданную сеть к контейнеру сервера Postgres:
       $ sudo docker run --name pg-docker --network pg-net -e POSTGRES_PASSWORD=postgres -d -p 5432:5432 -v /var/lib/postgres:/var/lib/postgresql/data postgres:14
   3. Запускаем отдельный контейнер с клиентом в общей сети с БД:
       $ sudo docker run -it --rm --network pg-net --name pg-client postgres:14 psql -h pg-docker -U postgres
   4. Проверяем, что подключились через отдельный контейнер:
       $ sudo docker ps -a
   5. Радуемся жизни %)

Копирование файлов БД
    Также можно между разными дистрибутивами линукса на остановленном кластере.
    Единственное файлы конфигурации могут быть в другом месте и должна быть та же основная версия Постгреса   