** ДЗ 19 Статистика

# Цель
- знать и уметь применять различные виды join'ов
- строить и анализировать план выполнения запроса
- оптимизировать запрос
- уметь собирать и анализировать статистику для таблицы

# Описание/Пошаговая инструкция выполнения домашнего задания:
В результате выполнения ДЗ вы научитесь пользоваться
различными вариантами соединения таблиц.
В данном задании тренируются навыки:
написания запросов с различными типами соединений
Необходимо:

ДЗ Выполняю на БД demo (big), схема bookings от PostgresPro.ru. БД загружена на ВМ в ЯО.

# Реализовать прямое соединение двух или более таблиц
    Запрос:
        select b.book_ref, t.passenger_name, f.flight_no, a.model 
        from bookings b 
        join tickets t on b.book_ref = t.book_ref 
        join ticket_flights tf on tf.ticket_no = t.ticket_no 
        join flights f on f.flight_id = tf.flight_id 
        join aircrafts a on f.aircraft_code = a.aircraft_code 
        where b.book_ref = '000048';
    Результат:
        |book_ref|passenger_name  |flight_no|model            |
        |--------|----------------|---------|-----------------|
        |000048  |SVETLANA IVANOVA|PG0368   |Бомбардье CRJ-200|
        |000048  |SVETLANA IVANOVA|PG0369   |Бомбардье CRJ-200|
        |000048  |YURIY KUZNECOV  |PG0368   |Бомбардье CRJ-200|
        |000048  |YURIY KUZNECOV  |PG0369   |Бомбардье CRJ-200|

# Реализовать левостороннее (или правостороннее) соединение двух или более таблиц
      Запрос:
        -- Получить по самолету 'Аэробус A320-200' в какие аэропорты он летает 
        select distinct a.model, f.flight_no, a2.airport_name  from aircrafts a  -- выбираем самолет, используем 
        left join flights f on f.aircraft_code = a.aircraft_code    -- добавляем рейсы в которых принимает участие самолет
        left join airports a2 on a2.airport_code = f.arrival_airport  -- добавляем аэропорты из которых самолет вылетал
        left join airports a3 on a3.airport_code = f.departure_airport  -- добавляем аэропорты в которые самолет прилетал
        where a.model = 'Аэробус A320-200';
        
      Результат:
        model	            flight_no	airport_name
        Аэробус A320-200	[NULL]	    [NULL]
        
        Самолет Аэробус A320-200 никуда не летает

# Реализовать кросс соединение двух или более таблиц
        Установил расширение PostGIS
        sudo apt-get install postgis


# Реализовать полное соединение двух или более таблиц
    Составим таблицу расстояний между всеми аэропортами в милях
    Включим расширения:
        create extension cube;
        create extension earthdistance;
    Составим кросс таблицу аэропортов друг с другом и посчитаем рассточние
        select  (a1.coordinates<@>a2.coordinates) as range, a1.airport_name, a2.airport_name
        from airports a1
        cross join airports a2;  -- Связь таблицы с самой собой
    Результат:
        range	            airport_name	airport_name
        0.0	                Якутск	        Якутск
        504.6982136015582	Якутск	        Мирный
        960.354387854238	Якутск	        Хабаровск-Новый
        1212.4864355055554	Якутск	        Елизово
        1166.9906631394033	Якутск	        Хомутово
        1295.2579251407533	Якутск	        Владивосток
        3008.3945538471407	Якутск	        Пулково
        3497.3577036890074	Якутск	        Храброво
        1602.6624560236223	Якутск	        Кемерово
        ...

# Реализовать запрос, в котором будут использованы разные типы соединений


# Сделать комментарии на каждый запрос
        Комментарии сделаны по тексту

# К работе приложить структуру таблиц, для которых выполнялись соединения
![ER-диаграмма БД bookings](Booking_DB_ER_diargam.png)

Задание со звездочкой*
Придумайте 3 своих метрики на основе показанных представлений, отправьте их через ЛК, а так же поделитесь с коллегами в слаке